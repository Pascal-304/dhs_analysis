---
title: "paper"
author: 
  - Pascal Lee Slew
  - Yunkyung Park
thanks: "Code and data are available at: https://github.com/Pascal-304/dhs_analysis."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "Four sentences"
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, echo=FALSE, message=FALSE}
# install.packages('bookdown')
# install.packages("stringr")
# install.packages("ggforce")
library(stringr) 
library(dplyr)
library(tidyverse) 
library(janitor)
library(ggplot2)
library(knitr)
library(kableExtra)
library(bookdown)
library(ggforce)
```

```{r readdata, echo=FALSE}
ghana <- read_csv('data/cleaned_data.csv', show_col_types = FALSE)
```

# Introduction

# Data

```{r total, echo=FALSE, fig.cap="Data"}
ghana %>%
  mutate(
    character = factor(character,
                       levels = c("Residence",
                                "Region",
                                "Mother\'s_education",
                                "Work_status",
                                "Occupation",
                                "Employment_status",
                                "Total"
                                )
                       )
           ) %>%
  group_by(character) %>%
  summarise(sum = sum(number_of_employed_women))
```

Table \@ref(tab:total) shows that 3,566 participated the survey, but there are 3 whom did not answer their employment status, etc. 

```{r data, echo=FALSE}
ghana %>%
  select(background, no_child_under_six, one_more_child_under_six, caretaker_respondent, character) %>%
  slice(1:10) %>%
  kable(caption='A subset of key features',
        col.names = c('Background', 'No child under six', '1+ child under six', 
                      'Child\'s caretaker - respondent', 'Character'),
        digits = 1,
        booktabs = FALSE,
        linesep = "")
```

# Results

## Mother's education

```{r motheredu, echo=FALSE, fig.cap="Mother's Education level"}
# select mother edu
mother_edu <-
  ghana %>%
  filter(character=="Mother\'s_education") %>%
  mutate(
    no_child_under_six = round(no_child_under_six/100 * number_of_employed_women, 0),
    one_more_child_under_six = round(one_more_child_under_six/100 * number_of_employed_women, 0)
  )

# make dataset in long format
edu_long <-
  mother_edu %>%
  select(-c(character, total)) %>%
  pivot_longer(!background, names_to = "variable", values_to = "count") %>%
  mutate(
    background = factor(background,
                        levels = c('No_education',
                                   'Primary',
                                   'Middle',
                                   'Secondary+')
    )
  )

edu_long %>%
  filter(variable == 'no_child_under_six' | variable == 'one_more_child_under_six') %>%
  ggplot(aes(x = background, y = count, fill = variable)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Mother's education", y = "Number of employed women", fill = "Child under six") +
  theme_minimal() +
  scale_fill_discrete(labels = c("No child under six", 
                                 "One or more child under six")) +
  scale_x_discrete(labels = c("No_education" = "No education"))
```

Figure \@ref(fig:motheredu) shows that there are less women who studied more than secondary school, and only the secondary+ turned out to be more likely to have no child under six. 

```{r mothereduchildcare, echo=FALSE, fig.cap="Distribution of child's caretaker by mother's education level"}
# caretaker aspect
edu_caretaker <-
  edu_long %>%
  filter(str_detect(variable, "^caretaker_")) %>%
  mutate(variable = str_replace_all(variable, "caretaker_", "")) %>%
  rename(caretaker = variable,
         percentage = count) %>%
  mutate(
    caretaker = factor(caretaker, 
                       levels = c('respondent',
                                  'partner',
                                  'other_relative',
                                  'neighbor',
                                  'hired',
                                  'child_in_school',
                                  'other_female_child',
                                  'other_male_child',
                                  'not_worked_since_birth',
                                  'other',
                                  'missing')
    )
  )

# plot the bar graph
edu_caretaker %>%
  ggplot(mapping=aes(x=caretaker, y=percentage, fill=caretaker)) +
  geom_bar(stat = "identity", position="dodge") + 
  theme_minimal() +
  labs(x='',
       caption = 'Respondent is currently employed but has not worked since last birth.') +
  theme(legend.position='none') +
  coord_flip() + 
  scale_x_discrete(
    labels = 
      c("respondent" = "respondent",
        "partner" = "partner",
        "other_relative" = "relative",
        "neighbor" = "neighbor",
        "hired" = "hired",
        "child_in_school" = "schooling",
        "other_female_child" = "female child",
        "other_male_child" = "male child",
        "not_worked_since_birth" = "not worked since birth",
        "other" = "other",
        "missing" = "missing")
  ) +
  facet_wrap(vars(background),
             dir = "v",
             scales = "free",
             labeller = labeller(background = 
                                   c("No_education" = "No education",
                                     "Primary" = "Primary",
                                     "Middle" = "Middle",
                                     "Secondary+" = "Secondary+")
                                 )
  )
```

## Work status

```{r workstatus, echo=FALSE, message=FALSE, fig.cap="Work status"}
# select work status
work_status <-
  ghana %>%
  filter(character=="Work_status") %>%
  mutate(
    no_child_under_six = round(no_child_under_six/100 * number_of_employed_women, 0),
    one_more_child_under_six = round(one_more_child_under_six/100 * number_of_employed_women, 0)
  )

# make dataset in long format
work_long <-
  work_status %>%
  select(-c(character, total)) %>%
  pivot_longer(!background, names_to = "variable", values_to = "count") %>%
  mutate(
    background = factor(background,
                        levels = c('For_family_member',
                                   'For_someone_else',
                                   'Self-employed')
    )
  )

work_long %>%
  filter(variable == 'no_child_under_six' | variable == 'one_more_child_under_six') %>%
  ggplot(aes(x = background, y = count, fill = variable)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Work status", y = "Number of employed women", fill = "Child under six") +
  theme_minimal() +
  labs(x='Work status', y='number of employed', fill='Child under six') +
  scale_x_discrete(labels = c("For_family_member" = "For family member",
                              "For_someone_else" = "For someone else")) + 
  scale_fill_discrete(labels = c("No child under six", 
                                 "One or more child under six"))
```

Figure \@ref(fig:workstatus) shows that

```{r workstatuschildcare, echo=FALSE, fig.cap="Distribution of child's caretaker by work status"}
# caretaker aspect
work_caretaker <-
  work_long %>%
  filter(str_detect(variable, "^caretaker_")) %>%
  mutate(variable = str_replace_all(variable, "caretaker_", "")) %>%
  rename(caretaker = variable,
         percentage = count) %>%
  mutate(
    caretaker = factor(caretaker, 
                       levels = c('respondent',
                                  'partner',
                                  'other_relative',
                                  'neighbor',
                                  'hired',
                                  'child_in_school',
                                  'other_female_child',
                                  'other_male_child',
                                  'not_worked_since_birth',
                                  'other',
                                  'missing')
    )
  )

# plot the bar graph
work_caretaker %>%
  ggplot(mapping=aes(x=caretaker, y=percentage, fill=caretaker)) +
  geom_bar(stat = "identity", position="dodge") + 
  theme_minimal() +
  labs(x='',
       caption = 'Respondent is currently employed but has not worked since last birth.') +
  theme(legend.position='none') +
  coord_flip() + 
  scale_x_discrete(
    labels = 
      c("respondent" = "respondent",
        "partner" = "partner",
        "other_relative" = "relative",
        "neighbor" = "neighbor",
        "hired" = "hired",
        "child_in_school" = "schooling",
        "other_child" = "siblings",
        "not_worked_since_birth" = "not worked since birth",
        "other" = "other",
        "missing" = "missing")
  ) +
  facet_wrap_paginate(vars(background),
                      ncol=2,
                      nrow=2,
                      dir = "h",
                      scales = "free",
                      labeller = labeller(background = c("For_family_member" = "For family member",
                                                         "For_someone_else" = "For someone else",
                                                         "Self-employed" = "Self-employed")
                      )
  )


```

## Occupation

```{r occupation, echo=FALSE, message=FALSE, fig.cap="Occupation"}
# select occupation
occupation <-
  ghana %>%
  filter(character=="Occupation") %>%
  mutate(
    no_child_under_six = round(no_child_under_six/100 * number_of_employed_women, 0),
    one_more_child_under_six = round(one_more_child_under_six/100 * number_of_employed_women, 0)
  )

# make dataset in long format
occup_long <-
  occupation %>%
  select(-c(character, total)) %>%
  pivot_longer(!background, names_to = "variable", values_to = "count") %>%
  mutate(
    background = factor(background,
                        levels = c('Agricultural',
                                   'Nonagricultural')
    )
  )

occup_long %>%
  filter(variable == 'no_child_under_six' | variable == 'one_more_child_under_six') %>%
  ggplot(aes(x = background, 
             y = count,
             fill = variable)) +
  geom_bar(stat = "identity",
           position = "dodge") +
  labs(x = "Occupation",
       y = "Number of employed women",
       fill = "Child under six") +
  theme_minimal() +
  scale_fill_discrete(labels = c("No child under six", 
                                 "One or more child under six"))
```

Figure \@ref(fig:occupation) shows that

```{r occupationchildcare, echo=FALSE, fig.cap="Distribution of child's caretaker by work status"}
# caretaker aspect
occup_caretaker <-
  occup_long %>%
  filter(str_detect(variable, "^caretaker_")) %>%
  mutate(variable = str_replace_all(variable, "caretaker_", "")) %>%
  rename(caretaker = variable,
         percentage = count) %>%
  mutate(
    caretaker = factor(caretaker, 
                       levels = c('respondent',
                                  'partner',
                                  'other_relative',
                                  'neighbor',
                                  'hired',
                                  'child_in_school',
                                  'other_female_child',
                                  'other_male_child',
                                  'not_worked_since_birth',
                                  'other',
                                  'missing'))
  )


# plot bar graph
occup_caretaker %>%
  ggplot(aes(x=caretaker, y=percentage, fill=background)) +
  geom_bar(stat = "identity", position="dodge") + 
  labs(x="Caretaker", y="Percentage (in %)", fill="Occupation") +
  theme_minimal() +
  coord_flip() +
  scale_x_discrete(
    labels = 
      c("respondent" = "respondent", 
        "partner" = "partner",
        "other_relative" = "relative",
        "neighbor" = "neighbor",
        "hired" = "hired",
        "child_in_school" = "schooling",
        "other_female_child" = "other female child",
        "other_male_child" = "other male child",
        "not_worked_since_birth" = "not worked since birth",
        "other" = "other",
        "missing" = "missing")
  )
```

## Employment status

```{r employmentstatus, echo=FALSE, message=FALSE, fig.cap="Employment status"}
# select employment status
employment_status <-
  ghana %>%
  filter(character=="Employment_status") %>%
  mutate(
    no_child_under_six = round(no_child_under_six/100 * number_of_employed_women, 0),
    one_more_child_under_six = round(one_more_child_under_six/100 * number_of_employed_women, 0)
  )

# make dataset in long format
emply_long <-
  employment_status %>%
  select(-c(character, total)) %>%
  pivot_longer(!background, names_to = "variable", values_to = "count") %>%
  mutate(
    background = factor(background,
                        levels = c('All_year_full_week',
                                   'All_year_part_week',
                                   'Seasonal',
                                   'Occasional'))
  )

emply_long %>%
  filter(variable == 'no_child_under_six' | variable == 'one_more_child_under_six') %>%
  ggplot(aes(x = background, y = count, fill = variable)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Employment status", y = "Number of employed women", fill = "Child under six") +
  theme_minimal() +
  scale_fill_discrete(labels = c("No child under six", 
                                 "One or more child under six")) +
  scale_x_discrete(labels = c("All_year_full_week" = "All year, full week",
                              "All_year_part_week" = "All year, part week")) +
  theme(axis.text.x = element_text(angle=15))
```

Figure \@ref(fig:employmentstatus) shows that

```{r employment_statuschildcare, echo=FALSE, fig.cap="Distribution of child's caretaker by work status"}
# caretaker aspect
emply_caretaker <-
  emply_long %>%
  filter(str_detect(variable, "^caretaker_")) %>%
  mutate(variable = str_replace_all(variable, "caretaker_", "")) %>%
  rename(caretaker = variable,
         percentage = count) %>%
  mutate(
    caretaker = factor(caretaker, 
                       levels = c('respondent',
                                  'partner',
                                  'other_relative',
                                  'neighbor',
                                  'hired',
                                  'child_in_school',
                                  'other_female_child',
                                  'other_male_child',
                                  'not_worked_since_birth',
                                  'other',
                                  'missing')
    )
  )

# plot the bar graph
emply_caretaker %>%
  ggplot(mapping=aes(x=caretaker, y=percentage, fill=caretaker)) +
  geom_bar(stat = "identity", position="dodge") + 
  theme_minimal() +
  labs(x='',
       caption = 'Respondent is currently employed but has not worked since last birth.') +
  theme(legend.position='none') +
  coord_flip() + 
  scale_x_discrete(
    labels = 
      c("respondent" = "respondent",
        "partner" = "partner",
        "other_relative" = "relative",
        "neighbor" = "neighbor",
        "hired" = "hired",
        "child_in_school" = "schooling",
        "other_child" = "siblings",
        "not_worked_since_birth" = "not worked since birth",
        "other" = "other",
        "missing" = "missing")
  ) +
  facet_wrap(vars(background),
             dir = "v",
             scales = "free",
             labeller = labeller(background = c("All_year_full_week" = "All year, full week",
                                                "All_year_part_week" = "All year, part week",
                                                "Seasonal" = "Seasonal",
                                                "Occasional" = "Occasional")
                                 )
  )

```

## Region

```{r map, warning = FALSE, echo = FALSE}
# install.packages('rnaturalearth')
# install.packages('sf')
library(rnaturalearth)
library(sf)
# devtools::install_github("ropensci/rnaturalearthhires")
# The st_centroid function takes the sf object and returns the center of 
# the polygon, again as a sf object.
map_ghana <- ne_states(country = 'Ghana', 
                       returnclass = 'sf')  # grab provinces within Ghana

map_ghana %>% 
  ggplot() +
  geom_sf( ) + 
  geom_text(data = st_centroid(map_ghana), 
            size = 3,
             aes(x = longitude, 
                 y = latitude,
                 label= woe_name)) +
  labs(title='Ghana Administrative Regions') +
  theme_minimal()
```



```{r residence, echo=FALSE}
# Urban vs Rural

# Obtain subset of dataset for residence area
residence <- ghana %>% 
  filter(character == 'Residence')

# look at survey respondents distribution in urban and rural areas
residence %>% 
  ggplot(aes(x = background, y = number_of_employed_women)) +
  geom_bar(stat = 'identity', fill = "burlywood") +
  labs(x = "Area",
       y = "Number of employed women") +
  theme_minimal()
```


```{r region, echo=FALSE}
# region subdataset
region <- ghana %>% 
  filter(character == "Region") %>% 
  mutate(background = recode(background,
                             'Western' = 'Western',
                             'Central' = 'Central',
                             'Greater_Accra' = 'Greater Accra',
                             'Volta' = 'Volta',
                             'Eastern' = 'Eastern',
                             'Ashanti' = 'Ashanti',
                             'Brong_Ahafo' = 'Brong Ahafo',
                             'Northen' = 'Northern',
                             'Upper_West' = 'Upper West',
                             'Upper_East' = 'Upper East'))

# number of survey respondents in the different administrative regions
region %>% 
  ggplot(aes(x = background,
             y = number_of_employed_women)) +
  geom_bar(stat = 'identity',
           fill = 'burlywood') +
  labs(x = "Administrative regions",
       y = "Number of employed women") +
  theme_minimal()
```



```{r, echo = FALSE}
# make dataset in long format
resid_long <- residence %>% 
  select(-c(character)) %>% 
  pivot_longer(!background, names_to = "variables", values_to = "percentage")

# create label names list
label_list <- list('no_child_under_six' = "No child under six", 
                   'one_more_child_under_six' = "One or more child under six")

labellers <- function(variable, value) {
  return(label_list[value])
}

# plot bar graph
resid_long %>% 
  filter(variables == 'no_child_under_six' | variables == 'one_more_child_under_six') %>% 
  ggplot(aes(x = background, 
             y = percentage,
             fill = variables)) +
  geom_bar(stat = 'identity',
           position = 'dodge') +
  labs(x = "Area",
       y = "Percentage of women",
       fill = "Children under six") +
  theme_minimal() +
  scale_fill_brewer() +
  theme(legend.position = "bottom")

# need to recode names
# change legends name
```


```{r, echo=FALSE}
# caretaker aspect

# make dataset into long format
# rename 
caretaker <- residence %>% 
  select(-c(character, no_child_under_six, one_more_child_under_six, total, number_of_employed_women)) %>% 
  pivot_longer(!background, names_to = "caretakers", values_to = "percentage") %>% 
  mutate(caretakers = recode(caretakers,
                             'caretaker_respondent' = 'respondent',
                             'caretaker_partner' = 'partner',
                             'caretaker_other_relative' = 'other relative',
                             'caretaker_other_male_child' = 'other male child',
                             'caretaker_other_female_child' = 'other female child',
                             'caretaker_other' = 'other',
                             'caretaker_not_worked_since_birth' = 'not worked since birth',
                             'caretaker_neighbor' = 'neighbour',
                             'caretaker_missing' = 'missing',
                             'caretaker_hired' = 'hired',
                             'caretaker_child_in_school' = 'child in school'))

# plot bar graph
caretaker %>% 
  ggplot(aes(x = caretakers, 
             y = percentage,
             fill = background)) +
  geom_bar(stat = 'identity',
           position = "dodge") +
  labs(x = "Caretaker",
       y = "Percentage of women",
       fill = "Area") +
  theme_minimal() +
  coord_flip() +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")

```

## Also comparison among the different administrative regions

```{r}
# region

child <- region %>% 
  select(-c(character, total)) %>% 
  pivot_longer(!background, names_to = "x", values_to = "percentage")


```



# Discussions

## Limitation and weaknesses

The number does not add up to 100. (round-off error)

\newpage

# References